/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/getaddress-autocomplete-native@1.1.1/lib/Autocomplete.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(u,n){function o(t){try{d(s.next(t))}catch(t){n(t)}}function l(t){try{d(s.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?u(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,l)}d((s=s.apply(t,e||[])).next())}))};import{AddressSelectedEvent,AddressSelectedFailedEvent,SuggestionsEvent,SuggestionsFailedEvent}from"./Events";export default class Autocomplete{constructor(t,e,i,s){this.input=t,this.client=e,this.output_fields=i,this.attributeValues=s,this.onInputFocus=()=>{this.attributeValues.options.select_on_focus&&this.input.select()},this.onInputPaste=()=>{setTimeout((()=>{this.populateList()}),100)},this.onInput=t=>{if(this.list&&t instanceof InputEvent==0&&t.target instanceof HTMLInputElement){const e=t.target;Array.from(this.list.querySelectorAll("option")).every((t=>t.innerText!==e.value||(this.handleSuggestionSelected(t),!1)))}},this.onKeyUp=t=>{this.debug(t),this.handleKeyUp(t)},this.onKeyDown=t=>{this.debug(t),this.handleKeyDownDefault(t)},this.debug=t=>{this.attributeValues.options.debug&&console.log(t)},this.handleComponentBlur=(t=!1)=>{clearTimeout(this.blurTimer);const e=t?0:100;this.blurTimer=setTimeout((()=>{this.clearList()}),e)},this.handleSuggestionSelected=t=>__awaiter(this,void 0,void 0,(function*(){if(this.attributeValues.options.enable_get){this.input.value="",this.attributeValues.options.clear_list_on_select&&this.clearList();const e=t.dataset.id;if(e){const t=yield this.client.get(e);if(t.isSuccess){let i=t.toSuccess();this.bind(i.address),AddressSelectedEvent.dispatch(this.input,e,i.address),this.attributeValues.options.input_focus_on_select&&(this.input.focus(),this.input.setSelectionRange(this.input.value.length,this.input.value.length+1))}else{const i=t.toFailed();AddressSelectedFailedEvent.dispatch(this.input,e,i.status,i.message)}}}else this.clearList()})),this.bind=t=>{t&&this.attributeValues.options.bind_output_fields&&(this.setOutputfield(this.output_fields.building_name,t.building_name),this.setOutputfield(this.output_fields.building_number,t.building_number),this.setOutputfield(this.output_fields.latitude,t.latitude.toString()),this.setOutputfield(this.output_fields.longitude,t.longitude.toString()),this.setOutputfield(this.output_fields.line_1,t.line_1),this.setOutputfield(this.output_fields.line_2,t.line_2),this.setOutputfield(this.output_fields.line_3,t.line_3),this.setOutputfield(this.output_fields.line_4,t.line_4),this.setOutputfield(this.output_fields.country,t.country),this.setOutputfield(this.output_fields.county,t.county),this.setOutputfield(this.output_fields.formatted_address_0,t.formatted_address[0]),this.setOutputfield(this.output_fields.formatted_address_1,t.formatted_address[1]),this.setOutputfield(this.output_fields.formatted_address_2,t.formatted_address[2]),this.setOutputfield(this.output_fields.formatted_address_3,t.formatted_address[3]),this.setOutputfield(this.output_fields.formatted_address_4,t.formatted_address[4]),this.setOutputfield(this.output_fields.town_or_city,t.town_or_city),this.setOutputfield(this.output_fields.locality,t.locality),this.setOutputfield(this.output_fields.district,t.district),this.setOutputfield(this.output_fields.residential,t.residential.toString()),this.setOutputfield(this.output_fields.sub_building_name,t.sub_building_name),this.setOutputfield(this.output_fields.sub_building_number,t.sub_building_number),this.setOutputfield(this.output_fields.thoroughfare,t.thoroughfare),this.setOutputfield(this.output_fields.postcode,t.postcode))},this.setOutputfield=(t,e)=>{if(!t)return;let i=document.getElementById(t);return i||(i=document.querySelector(t)),i&&(i instanceof HTMLInputElement?i.value=e:i.innerText=e),i},this.handleKeyDownDefault=t=>{t.key&&(1===t.key.length||"Unidentified"===t.key)&&(clearTimeout(this.filterTimer),this.filterTimer=setTimeout((()=>{this.input.value.length>=this.attributeValues.options.minimum_characters?this.populateList():this.clearList()}),this.attributeValues.options.delay))},this.handleKeyUp=t=>{if(("Backspace"===t.code||"Delete"===t.code)&&t){t.target==this.input&&(this.input.value.length<this.attributeValues.options.minimum_characters?this.clearList():this.populateList())}},this.populateList=()=>__awaiter(this,void 0,void 0,(function*(){var t;const e={all:!0,top:this.attributeValues.options.suggestion_count,template:"{formatted_address}{postcode,, }{postcode}"};this.attributeValues.options.filter&&(e.filter=this.attributeValues.options.filter);const i=null===(t=this.input.value)||void 0===t?void 0:t.trim(),s=yield this.client.autocomplete(i,e);if(s.isSuccess){const t=s.toSuccess(),e=[];if(this.list&&t.suggestions.length){for(let i=0;i<t.suggestions.length;i++){const s=this.getListItem(t.suggestions[i]);e.push(s)}this.list.replaceChildren(...e)}else this.clearList();SuggestionsEvent.dispatch(this.input,i,t.suggestions)}else{const t=s.toFailed();SuggestionsFailedEvent.dispatch(this.input,i,t.status,t.message)}})),this.clearList=()=>{this.list&&this.list.replaceChildren()},this.getListItem=t=>{const e=document.createElement("OPTION");let i=t.address;return e.innerText=i,e.dataset.id=t.id,e}}destroy(){this.destroyInput(),this.destroyList()}destroyList(){this.list&&this.list.remove()}destroyInput(){this.input.removeAttribute("list"),this.input.removeEventListener("focus",this.onInputFocus),this.input.removeEventListener("paste",this.onInputPaste),this.input.removeEventListener("keydown",this.onKeyDown),this.input.removeEventListener("keyup",this.onKeyUp),this.input.removeEventListener("input",this.onInput)}build(){this.input.setAttribute("list",`${this.attributeValues.listId}`),this.input.addEventListener("focus",this.onInputFocus),this.input.addEventListener("paste",this.onInputPaste),this.input.addEventListener("keydown",this.onKeyDown),this.input.addEventListener("keyup",this.onKeyUp),this.input.addEventListener("input",this.onInput),this.list=document.createElement("DATALIST"),this.list.id=this.attributeValues.listId,this.input.insertAdjacentElement("afterend",this.list)}}
//# sourceMappingURL=/sm/6c0017277f46e5efe5f6ab7e2eec44a238b1f7ceb65c294882160f5f6b46107d.map